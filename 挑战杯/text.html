<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Tutor Chat Test</title>
</head>
<body>
  <h2>AI WebSocket Chat</h2>
  <label>Token: <input type="text" id="token" size="80"></label><br>
  <button onclick="connectWS()">è¿æ¥ WebSocket</button><br><br>
  
  <textarea id="log" cols="100" rows="20" readonly></textarea><br>
  <input type="text" id="message" placeholder="è¾“å…¥é—®é¢˜" size="80">
  <button onclick="sendMessage()">å‘é€</button>

  <script>
    let ws = null;
    function log(msg) {
      const logBox = document.getElementById('log');
      logBox.value += msg + '\n';
      logBox.scrollTop = logBox.scrollHeight;
    }

    function connectWS() {
      const token = document.getElementById('token').value;
      const url = `ws://127.0.0.1:8000/chat/ws?token=${token}`;
      ws = new WebSocket(url);
      ws.onopen = () => log("âœ… å·²è¿æ¥ WebSocket");
      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data); // æ£€æŸ¥è¿”å›æ˜¯å¦ä¸ºæœ‰æ•ˆ JSON
          console.log("âœ… è§£ææˆåŠŸï¼Œå†…å®¹ï¼š", data);
        } catch (e) {
          console.error("âŒ æ— æ³•è§£æ JSON: ", event.data);
        }
      
        log("ğŸ“¥ æ”¶åˆ°: " + event.data);
      };
      ws.onerror = (err) => log("âŒ é”™è¯¯: " + err);
      ws.onclose = () => log("ğŸ”Œ è¿æ¥å·²å…³é—­");
    }

    function sendMessage() {
      const text = document.getElementById('message').value;
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(text);
        log("ğŸ“¤ å‘é€: " + text);
      } else {
        log("âš ï¸ WebSocket æœªè¿æ¥");
      }
    }
  </script>
</body>
</html>
